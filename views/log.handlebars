<!doctype html>

<html>
<head>
  <title>LifeUp Log</title>   
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/bootstrap-theme.min.css" rel="stylesheet">
  <link href="/css/home.css" rel="stylesheet">
  <link rel="stylesheet" href="jstree/themes/default/style.min.css" />

  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="/js/bootstrap.min.js"></script>

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

  <script src="checkList/jquery-1.8.0.min.js"></script>

  <link rel="stylesheet" type="text/css" href="css/jquery.countdown.css"> 
  <script type="text/javascript" src="js/jquery.plugin.js"></script> 
  <script type="text/javascript" src="js/jquery.countdown.js"></script>
  <!-- this is a comment in HTML -->

  <!-- checklist -->
  <script src="checkList/jquery-ui-1.8.23.custom.min.js"></script>
  <script src="checkList/jquery.ui.checkList.js"></script>

  <script type="text/javascript" src="js/vars.js"></script>

  <link rel="stylesheet" type="text/css" href="checkList/ui-lightness/jquery-ui-1.8.23.custom.css" />
  <link rel="stylesheet" type="text/css" href="checkList/checkList.css" />
  <style type='text/css'>     
        /*body {
            font-family: 'Segoe UI',Tahoma,Arial,Helvetica,sans-serif;
            vertical-align: top;
            font-size: .813em;
            line-height: 1.4em;
            color: #44525E;
          }*/

          #activityCheckList, #selected{
            display: block;
            margin-bottom: 10px;
            margin-left:auto;
            margin-right:auto;
            width: 95%;
            height: 60%;
            font-size: 2.813em;
          }
        </style>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
      <![endif]-->        
</head>

<body>
  <div class="container">
    <!-- <h1 class = "header">LifeUP | Log</h1> -->
     <div style="text-align: center">
          <div class="btn-group">
            <div class="btn btn-default headerbtn" onclick="window.location='/';">LifeUp</div>
            <div class="btn btn-default headerbtn" onclick="window.location='/log'">Log</div>
            <div class="btn btn-default headerbtn" onclick="window.location='/activity'">Activity</div>
            <div class="btn btn-default headerbtn" onclick="window.location='/settings'">Options</div>
          </div>
      </div>

    <div id="jstree">
      <ul>
        {{#each groups}}
        <li id="group{{id}}">{{name}}
          <ul>
            {{#each items}}
            <li id="action{{id}}">{{name}}</li>
            {{/each}}
          </ul>
        </li>
        {{/each}}
      </ul>
    </div>
        <!-- <li id="diet">Diet
          <ul>
            <li id="veggies">I ate veggies</li>
            <li id="water">I drank water</li>
            <li id="hungry">I ate when hungry</li>
          </ul>
        </li>
        <li id="exercise">Exercise
          <ul>
            <li id="run">I ran</li>
            <li id="gym">I worked out</li>
            <li id="move">I moved around</li>
          </ul>
        </li>
        <li id="social">Social
          <ul>
            <li id="laugh" value="1">I laughed</li>
            <li id="talk">I talked to people</li>
            <li id="friends">I made friends</li>
          </ul>
        </li>
        <li id="lifestyle">Lifestyle
          <ul>
            <li id="sleep">I slept enough</li>
            <li id="meditate">I meditated</li>
            <li id="thankful">I was thankful</li>
          </ul>
        </li>
        <li id="floss">Flossing</li>
      </ul>
    </div> -->

    <!--button>demo button</button-->

    <script>
      // var lifeIncreases = {
      //   diet: 0,
      //   veggies: 3,
      //   water: 1,
      //   hungry: 3,
      //   exercise: 0,
      //   run: 2,
      //   gym: 2,
      //   move: 2,
      //   social: 0,
      //   laugh: 2,
      //   talk: 1,
      //   friends: 1,
      //   lifestyle: 0,
      //   sleep: 3,
      //   meditate: 2,
      //   thankful: 1,
      //   floss: 1
      // };

      var lifeIncreases = {
        {{#each groups}}
          "{{id}}": {{value}},
          {{#each items}}
            "{{id}}": {{value}},
          {{/each}}
        {{/each}}
      };

      /*function LogFunction() {
          lifeExp = lifeExpPreview; // doesn't actually save yet becuase refresh.
          var selections = $('#activityCheckList').checkList('getSelection');
          var action_list = '';

          if(selections.length==0){
              return;
          }
          for (i=0;i<selections.length-1;++i) {
              action_list = action_list + selections[i].text + ",";
          }
          action_list = action_list + selections[selections.length-1].text;
          $.post("log_activity", {"selections":action_list, "lifeExp": lifeExp}, function (error, response, body) {
              if (!error && response.statusCode == 200) {
                  console.log(body);
              }
              window.location='/';
          });
      }*/
    </script>
              
    <script src="jstree/jstree.min.js"></script>

    <script>
      $(function () {
        // 6 create an instance when the DOM is ready

        $('#jstree').jstree({
          // "plugins" : ["checkbox"],
          // "core": {
          //     "themes":{
          //         "icons":false
          //     }
          // }
          "types" : {
            "default" : {
              "icon" : false
            }
            // "demo" : {
            //   "icon" : "glyphicon glyphicon-ok"
            // }
          },
          "plugins" : [ "checkbox","types" ]
        });
       
        // $(".jstree-themeicon-hidden").removeClass("jstree-themeicon-hidden")

        $("#jstree").jstree("open_node", $(".jstree-node")[0]); // open first node for demonstration

        // pre-select nodes that had already been selected today
        {{#each groups}}
        {{#each items}}
        if ({{done_today}}) {
          $("#jstree").jstree("select_node","action{{id}}");
        }
        {{/each}}
        {{/each}}


        // 7 bind to events triggered on the tree
        $('#jstree').on("changed.jstree", function (e, data) {

          lifeExpPreview = lifeExp;
          // $.each($("#jstree").jstree('get_selected'),function(index,value) { 
          //   // console.log(value);
          //    lifeExpPreview = lifeExpPreview + lifeIncreases[value];
          // });
          {{#each groups}}
          {{#each items}}
          if (!{{done_today}} && $("#jstree").jstree('is_selected', "action{{id}}")) {  // increase if new activity
            lifeExpPreview = lifeExpPreview + {{value}};
          }
          else if ({{done_today}} && !$("#jstree").jstree('is_selected', "action{{id}}")) {  // decrease if uncheck
            lifeExpPreview = lifeExpPreview - {{value}};
          }
          {{/each}}
          {{/each}}

          $('#lifespan').text(lifeExpPreview + ' years');
          var newYearPreview = new Date();
          newYearPreview = new Date(newYearPreview.getFullYear() + lifeExpPreview - currentAge, 1 - 1, 1);
          $('.sub_header2').countdown('option', {until: newYearPreview});

          console.log(data.selected);
        });
        // 8 interact with the tree - either way is OK
        $('button').on('click', function () {
          $('#jstree').jstree(true).select_node('child_node_1');
          $('#jstree').jstree('select_node', 'child_node_1');
          $.jstree.reference('#jstree').select_node('child_node_1');
        });
      });
    </script>

    <!-- checklist -->

    <!--div id='activityCheckList'></div-->

    <script type="text/javascript">
      var lifeExp = {{expLifeSpan}};
      var lifeExpPreview = lifeExp;
      var currentAge = {{curAge}};
      
      /*
      $(function() {
        var items = [{text: 'I ran', value: '3'},
        {text: 'I slept enough', value: '2'},
        {text: 'I ate veggies', value: '3'},
        {text: 'I made new friends', value: '1'},
        {text: 'I laughed', value: '1'},
        {text: 'I worked out', value: '1'},
        {text: 'I flossed', value: '1'},
        {text: 'I meditated', value: '2'},
        {text: 'I was thankful', value: '1'}
        ];

        $('#activityCheckList').checkList({
          listItems: items,
          onChange: selChange
        });

        function selChange(){
          var selection = $('#activityCheckList').checkList('getSelection');

          var lifeIncrease = 0;

          for (i=0;i<selection.length;++i) 
          {
            lifeIncrease += Number(selection[i].value);
          }

          lifeExpPreview = lifeExp + lifeIncrease;

          $('#lifespan').text(lifeExpPreview + ' years');


          var newYearPreview = new Date();
          newYearPreview = new Date(newYearPreview.getFullYear() + lifeExpPreview - currentAge, 1 - 1, 1);

          $('.sub_header2').countdown('option', {until: newYearPreview});
        }
      });*/
    </script>

    <h1 id="lifeIncrease_label" style="display:none; text-align: center ; background-color:#bce8f1;"></h1>

    <div class = "sub_header1"><a href="#"></a>
      <img class = "image" src="images/uptrans.png" />
      <div>
        <div class= "time_with_title">Life Expectancy:</div>
        <div class = "time" id="lifespan">{{expLifeSpan}} years </div>
      </div>
    </div>
    <div class = "sub_header2">
      <div class = "count_down_title">Life Remaining:</div>
      <div class = "count_down"> </div>
    </div>

    <div class="btn-group container">
      <div class="btn btn-default btn-large smallbutton pull-left" onclick="window.location='/';">Cancel</div>
      <div class="btn btn-primary btn-large smallbutton pull-right" onclick="LogFunction()">Log</div>
    </div>

    <div id="continue_button" class="btn btn-primary btn-large button" onclick="window.location='/';" style="display:none;">Continue</div>


    <script>

      function LogFunction() {
        var lifeIncrease = lifeExpPreview - lifeExp;
        lifeExp = lifeExpPreview;
        // var selections = $('#activityCheckList').checkList('getSelection');
        var selections = $("#jstree").jstree('get_selected');
        var action_list = '';

        if(selections.length==0){
          return;
        }
        for (i=0;i<selections.length-1;++i) {
          action_list = action_list + selections[i] + ",";
        }
        action_list = action_list + selections[selections.length-1];
        $.post("log_activity", {"selections":action_list, "lifeExp": lifeExp}, function (error, response, body) {
          if (!error && response.statusCode == 200) {
            console.log(body);
          }

          if (lifeIncrease == 0) {
            window.location='/';
          }
          else {
            $("#jstree").hide();
            $(".btn-group").hide();
            $(".header").text("Life Increased!");
            $("#continue_button").show();
            $("#lifeIncrease_label").show().text('+' + lifeIncrease + ' years!');
          }
        });
        
        $.post('/log/update', {'value':lifeExp});
      }
  </script>

  <script>
    var currentAge = {{curAge}};
    $('#lifespan').text(lifeExp + ' years');
    if (displayStyle == 1)
      $('.sub_header2').hide();
    else if (displayStyle == 2)
      $('.sub_header1').hide();
    var newYear = new Date(); 
    newYear = new Date(newYear.getFullYear() + lifeExp - currentAge, 1 - 1, 1);
    $('.count_down').countdown({until: newYear, compact: true, 
      format: 'YOWDHMS', description: ''});
    $('.sub_header1').click(function() {
      $('.sub_header1').hide();
      $('.sub_header2').show();
      displayStyle = 2;
    });
    $('.sub_header2').click(function() {
      $('.sub_header2').hide();
      $('.sub_header1').show();
      displayStyle = 1;
    });
  </script>
</body>
</html>
